{% extends 'core/base.html' %}

{% block title %}Productos - Viamatica Store{% endblock %}

{% block content %}
<div x-data="{ isModalOpen: {% if messages %}{% for message in messages %}{% if 'added_to_cart_modal' in message.tags %}true{% endif %}{% endfor %}{% else %}false{% endif %} }"
     x-init="if (isModalOpen) { setTimeout(() => { isModalOpen = false }, 2000) }"> 

     <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center my-12">
            <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight sm:text-5xl">Nuestros Productos</h1>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-500">Explora nuestra selección de productos de alta calidad.</p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            {% for product in products %}
            <div class="group bg-white rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-2 transition-all duration-300">
                <div class="relative">
                    {% if product.image %}
                        <img class="w-full h-56 object-cover" src="{{ product.image.url }}" alt="{{ product.name }}">
                    {% else %}
                        <img class="w-full h-56 object-cover" src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1399&auto-format&fit=crop" alt="Producto sin imagen">
                    {% endif %}
                    <div class="absolute top-0 right-0 m-2">
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-semibold px-2.5 py-1 rounded-full">{{ product.category.name }}</span>
                    </div>
                </div>
                <div class="p-6">
                    <h2 class="text-xl font-bold text-slate-800 truncate">{{ product.name }}</h2>
                    <p class="text-slate-500 text-sm mt-2 h-10">{{ product.description|truncatewords:10 }}</p>
                    <div class="flex justify-between items-center mt-6">
                        <span class="text-3xl font-bold text-indigo-600">${{ product.price }}</span>
                        <form action="{% url 'product-list-page' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="product_id" value="{{ product.id }}">
                            <button type="submit" class="inline-flex items-center justify-center bg-gradient-to-r from-indigo-600 to-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:from-indigo-700 hover:to-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-300 group-hover:scale-105">
                                <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                                Añadir
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div x-show="isModalOpen" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/75 flex items-center justify-center z-30"
         style="display: none;">
        
        <div @click.away="isModalOpen = false" 
             x-show="isModalOpen"
             x-transition:enter="ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
             x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
             x-transition:leave="ease-in duration-200"
             x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
             x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
             class="bg-white rounded-xl shadow-xl transform transition-all sm:max-w-lg sm:w-full p-6 text-center">
            
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                <svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
            </div>
            <div class="mt-3">
                <h3 class="text-lg leading-6 font-bold text-gray-900">¡Añadido!</h3>
                <div class="mt-2 px-4 text-sm text-gray-500">
                    {% for message in messages %}{% if 'added_to_cart_modal' in message.tags %}<p>{{ message }}</p>{% endif %}{% endfor %}
                </div>
            </div>
            <div class="mt-8 space-y-4 md:space-y-0 md:space-x-4 md:flex md:justify-center">
                <a href="{% url 'cart' %}" class="w-full md:w-auto inline-flex justify-center rounded-lg border border-transparent shadow-sm px-6 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700">Ver Carrito</a>
                <button @click="isModalOpen = false" type="button" class="w-full md:w-auto inline-flex justify-center rounded-lg border border-gray-300 shadow-sm px-6 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50">Seguir Comprando</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}